# Стандарт обработки ошибок

**Версия:** 1.0  
**Приоритет:** Критичный  
**Источник:** Глава 4. Встроенный язык

---

## Правило: ВСЕГДА обрабатывать исключения

**Критично:** Экспортные функции ДОЛЖНЫ иметь обработку исключений с логированием.

```bsl
// ❌ НЕПРАВИЛЬНО: Нет обработки исключений
Функция ПолучитьДанные(Ссылка) Экспорт
    Запрос = Новый Запрос;
    Запрос.Текст = "ВЫБРАТЬ * ИЗ Справочник.Товары ГДЕ Ссылка = &Ссылка";
    Запрос.УстановитьПараметр("Ссылка", Ссылка);
    Возврат Запрос.Выполнить(); // ОШИБКА: нет обработки исключений
КонецФункции

// ✅ ПРАВИЛЬНО: Обработка исключений
Функция ПолучитьДанные(Ссылка) Экспорт
    Попытка
        Запрос = Новый Запрос;
        Запрос.Текст = "ВЫБРАТЬ * ИЗ Справочник.Товары ГДЕ Ссылка = &Ссылка";
        Запрос.УстановитьПараметр("Ссылка", Ссылка);
        Возврат Запрос.Выполнить();
    Исключение
        ТекстОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
        ЗаписьЖурналаРегистрации("Ошибка", УровеньЖурналаРегистрации.Ошибка,,, ТекстОшибки);
        ВызватьИсключение;
    КонецПопытки;
КонецФункции
```

---

## Структура обработки ошибок

1. `Попытка...Исключение` — блок обработки ошибок
2. `ПодробноеПредставлениеОшибки()` — получение деталей ошибки
3. `ЗаписьЖурналаРегистрации()` — логирование ошибки
4. `ВызватьИсключение` — проброс ошибки выше (если требуется)

---

---

## Обработка ошибок в транзакциях

**Правило:** При использовании транзакций обработка исключений должна включать откат транзакции и логирование ошибки.

```bsl
// ✅ ПРАВИЛЬНО: Обработка ошибок в транзакции
НачатьТранзакцию();
Попытка
    НовыйОбъект = Справочники.Товары.СоздатьЭлемент();
    НовыйОбъект.Наименование = "Новый товар";
    НовыйОбъект.Записать();
    ЗафиксироватьТранзакцию();
Исключение
    ОтменитьТранзакцию();
    ТекстОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
    ЗаписьЖурналаРегистрации("Ошибка записи товара", УровеньЖурналаРегистрации.Ошибка,,, ТекстОшибки);
    ВызватьИсключение;
КонецПопытки;
```

**Источник:** Раздел 11. Обработка исключений при использовании транзакций

---

## Обработка ошибок в запросах

**Правило:** При выполнении запросов следует обрабатывать возможные ошибки выполнения.

```bsl
// ✅ ПРАВИЛЬНО: Обработка ошибок запроса
Попытка
    Запрос = Новый Запрос("ВЫБРАТЬ * ИЗ Справочник.Товары ГДЕ Ссылка = &Ссылка");
    Запрос.УстановитьПараметр("Ссылка", Ссылка);
    Результат = Запрос.Выполнить();
Исключение
    ТекстОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
    ЗаписьЖурналаРегистрации("Ошибка выполнения запроса", УровеньЖурналаРегистрации.Ошибка,,, ТекстОшибки);
    ВызватьИсключение;
КонецПопытки;
```

---

## Обработка ошибок при блокировке объектов

**Правило:** При блокировке объектов следует обрабатывать исключения и информировать пользователя.

```bsl
// ✅ ПРАВИЛЬНО: Обработка ошибок блокировки
Объект = Ссылка.ПолучитьОбъект();
Попытка
    Объект.Заблокировать();
    Объект.Реквизит = НовоеЗначение;
    Объект.Записать();
Исключение
    ТекстОшибки = "Не удалось заблокировать запись. Объект уже заблокирован: " + ОписаниеОшибки();
    Сообщить(ТекстОшибки);
    ЗаписьЖурналаРегистрации("Ошибка блокировки объекта", УровеньЖурналаРегистрации.Предупреждение,,, ТекстОшибки);
    ВызватьИсключение;
КонецПопытки;
```

**Источник:** Раздел 11. Блокировка данных объекта для редактирования (строки 3430-3451)

---

## Обработка ошибок в модулях объектов

**Правило:** Обработчики событий модулей объектов должны обрабатывать исключения с логированием.

```bsl
// ✅ ПРАВИЛЬНО: Обработка ошибок в обработчике события
Процедура ПриЗаписи(Отказ)
    Попытка
        // Логика обработки записи
    Исключение
        ТекстОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
        ЗаписьЖурналаРегистрации("Ошибка при записи", УровеньЖурналаРегистрации.Ошибка,,, ТекстОшибки);
        Отказ = Истина;
    КонецПопытки;
КонецПроцедуры
```

---

## Чек-лист проверки

- [ ] Все экспортные функции имеют обработку исключений
- [ ] Используется `ПодробноеПредставлениеОшибки()` для получения деталей
- [ ] Ошибки логируются через `ЗаписьЖурналаРегистрации()`
- [ ] При необходимости ошибка пробрасывается выше
- [ ] В транзакциях при ошибке вызывается `ОтменитьТранзакцию()`
- [ ] Ошибки запросов обрабатываются с логированием
- [ ] Ошибки блокировки объектов обрабатываются с информированием пользователя
- [ ] Обработчики событий модулей объектов обрабатывают исключения

---

**Ссылки на исходный документ:**
- Глава 4. Встроенный язык
- Раздел 11. Обработка исключений при использовании транзакций
- Раздел 11. Блокировка данных объекта для редактирования (строки 3430-3451)

