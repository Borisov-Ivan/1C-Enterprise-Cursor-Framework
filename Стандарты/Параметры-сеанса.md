# Стандарт использования параметров сеанса

**Версия:** 1.0  
**Приоритет:** Высокий  
**Источник:** Раздел "Использование параметров сеанса" (строки 326-381)

---

## Описание

Параметры сеанса предназначены для хранения значений определенных типов для каждого клиентского сеанса на время работы этого сеанса. Инициализацию параметров сеанса следует выполнять в модуле сеанса, а их значения рекомендуется использовать в запросах и условиях ограничения доступа к данным для текущего сеанса.

---

## Правила

### Правило 1: Назначение параметров сеанса

**Критично:** Параметры сеанса предназначены для хранения значений определенных типов для каждого клиентского сеанса на время работы этого сеанса. Их значения рекомендуется использовать в запросах и условиях ограничения доступа к данным для текущего сеанса.

**Примеры параметров сеанса:**
- `ТекущийПользователь` – тип `СправочникСсылка.Пользователи`
- `ОбменДаннымиВключен` – тип `Булево`
- `РабочееМестоКлиента` – тип `СправочникСсылка.РабочиеМеста`

```bsl
// Использование параметра сеанса в коде:
ЗначениеТекущегоПользователя = ПараметрыСеанса.ТекущийПользователь;

// Использование в запросе:
Запрос.Текст = "ВЫБРАТЬ * ИЗ Документ.ЗаказПокупателя ГДЕ Документ.Пользователь = &ТекущийПользователь";
```

**Источник:** Раздел "Использование параметров сеанса", пункт 1.1

---

### Правило 2: Запрет использования параметров сеанса для клиентской логики

**Критично:** Не рекомендуется использовать параметры сеанса для хранения значений, используемых исключительно в клиентской логике. Поскольку в клиент-серверном варианте 1С:Предприятия параметры сеанса хранятся на сервере, то любое их считывание или изменение в процессе работы на клиенте потребует дополнительного серверного вызова и увеличит объем передаваемых данных.

```bsl
// ❌ НЕПРАВИЛЬНО: Использование параметров сеанса для клиентской логики
&НаКлиенте
Процедура ОбработкаКлиентскихДанных()
    Значение = ПараметрыСеанса.КлиентскоеЗначение; // ОШИБКА: лишний серверный вызов
КонецПроцедуры

// ✅ ПРАВИЛЬНО: Использование глобальных переменных модуля приложения
&НаКлиенте
Перем КлиентскоеЗначение; // Глобальная переменная модуля приложения

Процедура ОбработкаКлиентскихДанных()
    Значение = КлиентскоеЗначение; // Нет серверного вызова
КонецПроцедуры
```

**Источник:** Раздел "Использование параметров сеанса", пункт 1.2

---

### Правило 3: Запрет использования параметров сеанса для кеширования

**Критично:** Не рекомендуется использовать параметры сеанса для кеширования вычисленных значений, которые многократно используются в серверной бизнес-логике. В таких случаях следует определять функцию в серверном общем модуле с повторным использованием возвращаемых значений.

```bsl
// ❌ НЕПРАВИЛЬНО: Кеширование через параметры сеанса
&НаСервере
Функция ПолучитьВычисленноеЗначение()
    Если Не ЗначениеЗаполнено(ПараметрыСеанса.ВычисленноеЗначение) Тогда
        ПараметрыСеанса.ВычисленноеЗначение = ВычислитьЗначение(); // ОШИБКА
    КонецЕсли;
    Возврат ПараметрыСеанса.ВычисленноеЗначение;
КонецФункции

// ✅ ПРАВИЛЬНО: Использование модуля с повторным использованием возвращаемых значений
&НаСервере
Функция ПолучитьВычисленноеЗначение() Экспорт
    // Функция в модуле с признаком "Повторное использование возвращаемых значений"
    Возврат ВычислитьЗначение(); // Кешируется автоматически платформой
КонецФункции
```

**Исключение:** Исключение составляют случаи, когда время вычисления результата функции модуля с повторным использованием возвращаемых значений соизмеримо с периодом сброса платформенного кеша.

**Источник:** Раздел "Использование параметров сеанса", пункт 1.3

---

### Правило 4: Установка параметров сеанса "по требованию"

**Критично:** Не следует производить инициализацию параметров сеанса при запуске программы. Правильным способом установки значений параметров сеанса является установка значений "по требованию" в обработчике `УстановкаПараметровСеанса` модуля сеанса. Параметры сеанса должны быть инициализированы только в тот момент, когда к ним происходит первое обращение, как к неустановленным.

```bsl
// ✅ ПРАВИЛЬНО: Установка параметров сеанса "по требованию"
Процедура УстановкаПараметровСеанса(ИменаПараметровСеанса)
    Если ИменаПараметровСеанса = Неопределено Тогда
        // Раздел установки параметров сеанса при начале сеанса
        // Выполняется установка параметров сеанса, которые можно инициализировать
        // при начале работы системы
    Иначе
        // Установка параметров сеанса "по требованию"
        // Параметры сеанса, инициализация которых требует обращения к одним и тем же данным,
        // следует инициализировать сразу группой
        УстановленныеПараметры = Новый Массив;
        Для Каждого ИмяПараметра Из ИменаПараметровСеанса Цикл
            УстановитьЗначениеПараметраСеанса(ИмяПараметра, УстановленныеПараметры);
        КонецЦикла;
    КонецЕсли;
КонецПроцедуры

Процедура УстановитьЗначениеПараметраСеанса(Знач ИмяПараметра, УстановленныеПараметры)
    // Если в данном вызове УстановкаПараметровСеанса параметр уже был установлен - возврат
    Если УстановленныеПараметры.Найти(ИмяПараметра) <> Неопределено Тогда
        Возврат;
    КонецЕсли;
    
    Если ИмяПараметра = "ТекущийПользователь" Тогда
        ПараметрыСеанса.ТекущийПользователь = <значение>;
        УстановленныеПараметры.Добавить(ИмяПараметра);
    КонецЕсли;
КонецПроцедуры
```

**Источник:** Раздел "Использование параметров сеанса", пункт 2.1

---

## Чек-лист проверки

- [ ] Параметры сеанса используются только для хранения значений для текущего сеанса
- [ ] Параметры сеанса используются в запросах и условиях ограничения доступа к данным
- [ ] Параметры сеанса НЕ используются для хранения значений, используемых исключительно в клиентской логике
- [ ] Параметры сеанса НЕ используются для кеширования вычисленных значений (используются модули с повторным использованием возвращаемых значений)
- [ ] Параметры сеанса инициализируются "по требованию" в обработчике `УстановкаПараметровСеанса`
- [ ] Параметры сеанса, инициализация которых требует обращения к одним и тем же данным, инициализируются группой

---

**Ссылка на исходный документ:** Раздел "Использование параметров сеанса" (строки 326-381)

