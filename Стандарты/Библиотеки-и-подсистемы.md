# Стандарт разработки библиотек и подсистем

**Версия:** 1.0  
**Приоритет:** Средний  
**Источник:** Разделы 6, 15. Использование подсистем, Библиотеки и подсистемы (строки 382-409, 6000-6200)

---

## Описание

Стандарт определяет правила разработки библиотек и подсистем в конфигурации 1С:Предприятие. Включает требования к организации конфигурации через подсистемы, обеспечению обратной совместимости библиотек и разработке ролей в библиотеках.

---

## Использование подсистем

**Правило:** Конфигурация должна быть организована через подсистемы для логической группировки объектов метаданных.

**Требования:**
- Объекты метаданных должны быть распределены по подсистемам по функциональному признаку
- Подсистемы должны отражать логическую структуру конфигурации
- Рекомендуется использовать иерархию подсистем для сложных конфигураций

**Пример структуры подсистем:**
```
Подсистема "Управление номенклатурой"
├── Справочник "Номенклатура"
├── Справочник "Характеристики"
└── Регистр "ЦеныНоменклатуры"

Подсистема "Управление складом"
├── Справочник "Склады"
├── Регистр "ТоварыНаСкладах"
└── Документ "ПеремещениеТоваров"
```

**Источник:** Раздел 6. Использование подсистем (строки 382-409)

---

## Размещение сведений о настройках подсистемы

**Правило:** Настройки подсистемы, общие для всех объектов или группы объектов, рекомендуется задавать в переопределяемом модуле через процедуру `ПриОпределенииНастроек`.

```bsl
// ✅ ПРАВИЛЬНО: Определение настроек подсистемы
Процедура ПриОпределенииНастроек(Настройки) Экспорт
    Настройки.ВыводитьОтчетыВместоВариантов = Истина;
    Настройки.ВыводитьОписания = Истина;
    Настройки.ДругиеОтчеты.ПоказыватьФлажок = Истина;
КонецПроцедуры
```

**Требования:**
- Использовать структуру в качестве параметра для расширяемости
- Настройки, специфичные для отдельного объекта, размещать в модуле менеджера этого объекта
- Имена процедур выбирать исходя из выполняемого действия

**Источник:** Раздел 15. Размещение сведений о настройках подсистемы (строки 6012-6040)

---

## Обеспечение обратной совместимости библиотек

**Правило:** При разработке библиотек необходимо обеспечивать обратную совместимость между различными версиями библиотек в пределах одной редакции.

**Требования:**
- Выделить программный интерфейс библиотеки, скрыв детали реализации
- Не изменять программный интерфейс и поведение, только расширять
- Размещать программный интерфейс библиотеки в общих модулях

```bsl
// ✅ ПРАВИЛЬНО: Устаревшая функция с пометкой и вызовом новой
// Устарела: Следует использовать функцию ПересчитатьПоКурсу
Функция ПересчитатьИзВалютыВВалюту(Сумма, ВалютаНач, ВалютаКон, ПоКурсуНач, ПоКурсуКон, ПоКратностьНач = 1, ПоКратностьКон = 1) Экспорт
    Возврат ПересчитатьПоКурсу(Сумма, ВалютаНач, ВалютаКон, ПоКурсуНач, ПоКурсуКон, ПоКратностьНач, ПоКратностьКон);
КонецФункции

Функция ПересчитатьПоКурсу(Сумма, ВалютаНач, ВалютаКон, ПоКурсуНач, ПоКурсуКон, ПоКратностьНач = 1, ПоКратностьКон = 1) Экспорт
    // Новая реализация
КонецФункции
```

**Что не нарушает обратную совместимость:**
- Добавление нового реквизита в справочник, регистр
- Добавление новой функции
- Добавление необязательного параметра в конец списка параметров существующей функции

**Источник:** Раздел 15. Обеспечение обратной совместимости библиотек (строки 6042-6142)

---

## Разработка ролей в библиотеках

**Правило:** Библиотека должна предоставлять готовый набор ролей для работы со своими данными.

**Требования:**
- В библиотеку включаются объекты метаданных, которые в неизменном или переопределенном виде войдут в состав конфигураций-потребителей
- Объекты, специфичные для конкретной конфигурации-потребителя, в библиотеке не разрабатываются
- В ролях могут быть определены не только права к библиотечным объектам, но и логика ограничений доступа на уровне записей (RLS)

**Исключения:**
- Библиотечный объект не является "самостоятельным", а всегда подчинен объекту-владельцу конфигурации
- Библиотечный объект не является полностью законченным объектом, готовым для использования "как есть"
- Библиотека не содержит данных, а только алгоритмы для работы с ними

**Источник:** Раздел 15. Разработка ролей в библиотеках (строки 6143-6172)

---

## Программный интерфейс библиотеки

**Правило:** Программный интерфейс библиотеки должен быть размещен в общих модулях, а не в модулях объектов, менеджеров, наборов записей.

**Требования:**
- Разделять программный интерфейс от служебных процедур и функций (разные разделы модуля или разные общие модули)
- К модулям со служебными процедурами может быть добавлен постфикс `Служебный`
- Программный интерфейс библиотеки является самостоятельным предметом проектирования

**Пример структуры:**
```
Общие модули:
- ОбменСообщениями (программный интерфейс)
- ОбменСообщениямиКлиент (программный интерфейс)
- ОбменСообщениямиСлужебный (служебные процедуры)
```

**Источник:** Раздел 15. Обеспечение обратной совместимости библиотек (строки 6060-6080)

---

## Чек-лист проверки

- [ ] Конфигурация организована через подсистемы
- [ ] Настройки подсистемы задаются в переопределяемом модуле
- [ ] Обеспечена обратная совместимость библиотек в пределах редакции
- [ ] Программный интерфейс библиотеки выделен и размещен в общих модулях
- [ ] Устаревшие функции помечены комментариями и вызывают новые версии
- [ ] Библиотека предоставляет готовый набор ролей для работы с данными
- [ ] Программный интерфейс разделен от служебных процедур

---

**Ссылки на исходный документ:**
- Раздел 6: Использование подсистем (строки 382-409)
- Раздел 15. Размещение сведений о настройках подсистемы (строки 6012-6040)
- Раздел 15. Обеспечение обратной совместимости библиотек (строки 6042-6142)
- Раздел 15. Разработка ролей в библиотеках (строки 6143-6172)

